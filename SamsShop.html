


<!DOCTYPE html>
<html>
  <head>
    <title>SamsShop</title>
    <h1>Tammy's Tamowatches</h1>
    <style>
      /* Grid container for the shop items */
    .shop-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Individual shop item style */
    .shop-item {
      text-align: center;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
    }

    /* Placeholder image style */
    .shop-item img {
      width: 100%;
      height: auto;
      max-height: 200px;
      object-fit: cover;
      border-radius: 4px;
    }
    
    /* Buy button style */
    .shop-item button {
      margin-top: 10px;
      padding: 8px 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .shop-item button:hover {
      background-color: #0056b3;
    }

    .buttonBought {
      background-color: red !important;
    }
  

    </style>


  </head>
  <body>
    <input type="text" class="textField" id="createItem" style="margin-left:33%">
    <button type="submit" class="button" id="createButton" style="margin-top:30px; margin-left:35% ">Create</button>
    <div id="bank">num</div>
    <div id="shop-grid">s</div>
  </body>

  

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-analytics.js";
    const firebaseConfig = {
      apiKey: "AIzaSyCDsIup2KaJeQMPL5jvCMzMA7RTpPiPg7o",
      authDomain: "tomotaru-bb27a.firebaseapp.com",
      databaseURL: "https://tomotaru-bb27a-default-rtdb.firebaseio.com",
      projectId: "tomotaru-bb27a",
      storageBucket: "tomotaru-bb27a.appspot.com",
      messagingSenderId: "281838524572",
      appId: "1:281838524572:web:ee113e29d661a9c1a73559",
      measurementId: "G-9HY07GMSFH"
    };
    const app = initializeApp(firebaseConfig);


    import {getDatabase, set, get, update, remove, ref, child, push}
    from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";
    const db=getDatabase();

    const shopItemCount = 4;
    const testingBankAmount = 100;

    async function loadProducts() {
      try {
        const response = await fetch('items.json');
        const items = await response.json();
        const container = document.getElementById('shop-grid');

        items.forEach(item => {
          const productDiv = document.createElement('div');
          productDiv.className = 'shop-item';
          productDiv.innerHTML = `
            <img src="${item.img}" alt="${item.name}">
            <h3>${item.name}</h3>
            <p>Price: $${item.price}</p>
            <p>${item.description}</p>
            `;
            productDiv.appendChild(createProductButton(item));
            container.appendChild(productDiv);
            FindData(item);
        });
      } catch (error) {
        console.error('Error Loading Products: ', error);
      }
    }

    function createProductButton(item) {
      const button = document.createElement('button');
      button.id = "button" + item.id.toString();
      button.innerText = "Add to Cart";
      button.onclick = () => CheckCanBuy(item);
      console.log(button.id);
      return button;
    }


    async function CheckCanBuy(unparsedItem) {
      console.log(unparsedItem);
      let potentialItem = unparsedItem;
      let itemExists = await FindData(potentialItem);
      let temp = "button" + potentialItem.id.toString();
      let button = document.getElementById(temp);
      console.log(button);
      if ((testingBankAmount >= potentialItem.price) && !itemExists){
        UpdateButton(button, potentialItem);
        CreateItem(potentialItem);
        
        console.log('bought');
      }
      else{
        console.log("item exists already: ", itemExists);
        console.log("funds available: ", testingBankAmount >= potentialItem.price);
      }
    }



    function CreateItem(addedItem){
      //console.log(addedItem);
    set(ref(db, "Groups/" + "Inventory/" + addedItem.name), {
        Item: addedItem.name
    })
    .then(() => {
      //console.log("Data Created");
    })
    .catch((error) => {
        console.log(error);
      })
  }

    function FindData(item) {
      const dbref = ref(db);
      let temp = "#button" + item.id.toString();
      let button = document.querySelector(temp);
    
      return get(child(dbref, "Groups/" + "Inventory/" + item.name))
        .then((snapshot) => {
          //console.log(temp);
          if (snapshot.exists()){
            UpdateButton(button, snapshot.val().Item);
            return true;
          } else {
            //console.log("No Data Found");
            return false;
          }
        })
        .catch((error) => {
          console.log(error);
          return false;
        });
    }

//unused
    function UpdateData() {
      update(ref(db, "Groups/" + enterID.value), {
        Name: enterName.value,
        Age: enterAge.value
      })
      .then(() => {
        console.log("Data Updated");
      })
      .catch((error) => {
        console.log(error);
      })
    }
//unused
    function RemoveData() {
      remove(ref(db, "Groups/" + enterID.value))
      .then(() => {
        console.log("Data Removed");
      })
      .catch((error) => {
        console.log(error);
      })
    }

    function UpdateButton(button, item){
      button.innerHTML = 'Bought';
      button.classList.add('buttonBought');
    }

    function AddToInventory() {
      console.log('hi');
      /* this appends but in a store nothing is added, it is added in the inventory not here 
      simply add to the database instead */
      const newItem = document.getElementById("createItem").value;
      const shopItem = document.createElement("shop-item");
      shopItem.textContent = newItem;   
      document.getElementById("shop-grid").appendChild(shopItem);
      document.getElementById("createItem").value = "";
    }

    document.addEventListener('DOMContentLoaded', function() {
      let bankDiv = document.getElementById("bank");
      bankDiv.innerHTML = testingBankAmount;
      loadProducts();
      
    });
  </script>
</html>